---
description: 根据用户反馈对项目进行纠正并记录
---

**用户输入**: $ARGUMENTS

## 执行流程

1. **检查用户输入**:
   - 如用户未提供内容则提示"请提供需要纠正的具体内容"并结束命令

2. **检查项目宪法**:
   - 读取宪法文件 `specify/constitution.md`（如存在）
   - 确保后续操作符合宪法约束

3. **获取当前主题**:
   - 扫描 `specify/` 目录找到最新主题目录（按序号排序）
   - 读取最新主题目录下的 `discuss.md` 文件了解内容
   - 如无主题目录则提示运行 `/senatus.new-topic` 并结束命令

4. **读取研究基础**:
   - 读取 `specify/{当前主题目录}/research.md` 文件（如存在）
   - 如研究文件不存在则建议先运行 `/senatus.research`
   - 基于现有研究结果分析项目现状

5. **检查已有实现记录**:
   - 检查 `specify/{当前主题目录}/implementation/` 目录是否存在
   - 如存在实现记录文件，读取所有已完成的实现内容
   - 这些是已完成的工作，需要作为纠正操作的参考

6. **执行项目纠正**:
   - 基于主题、已有讨论、研究基础、已有实现记录和项目源码理解项目背景
   - 根据用户输入定位问题
   - **严格遵循项目宪法约束**
   - **多轮迭代纠正过程**：
     - 执行纠正操作（代码、配置、文档等）
     - 请用户测试并提供反馈
     - 根据反馈继续纠正和优化
     - 重复上述步骤直到用户确认问题已完全解决
   - 问题解决后，继续执行后续记录步骤

7. **记录讨论**:
   - 检查 `specify/{当前主题目录}/discuss.md` 文件，确定下一个编号（D01, D02, D03...）
   - 在 `specify/{当前主题目录}/discuss.md` 文件讨论记录部分添加：
     ```markdown
     ### D[编号] - YYYY-MM-DD HH:MM:SS
     **问题**: [用户提出的纠正要求]
     **结论**: [执行的纠正操作和结果]
     ```
   - **注意**：记录中不要引用任务编号（如 T01、T02 等），避免回滚时产生歧义

8. **更新任务计划**:
   - 读取 `specify/{当前主题目录}/plan.md` 文件
   - 如任务计划文件不存在则提示运行 `/senatus.plan` 并结束命令
   - 确定下一个任务编号（T01, T02, T03...）
   - 在任务清单部分添加新的任务项：
     ```markdown
     T01. [✅已完成] 纠正操作描述
     ```

9. **生成实现记录**:
   - 在 `specify/{当前主题目录}/` 下创建 `implementation/` 目录（如不存在）
   - 读取模板文件 `.specify/implementation-template.md`
   - 替换模板占位符：
     - `{{TASK_ID}}` → 任务编号
     - `{{TASK_DESCRIPTION}}` → 纠正操作描述
     - `{{IMPLEMENTATION_DETAILS}}` → 详细纠正细节（包含变更的代码段）
     - `{{CURRENT_DATE}}` → 当前日期（YYYY-MM-DD）
   - 生成目标文件 `specify/{当前主题目录}/implementation/{TASK_ID}.md`（如文件已存在则覆盖）

## 输出结果
- 执行的纠正操作描述
- 新增的讨论记录编号
- 新增的任务项编号（已完成状态）