# 项目宪法 - Spec Viewer

## 约束总则

本宪法定义了 Spec Viewer 项目开发过程中必须遵循的全局约束和原则。所有讨论、研究、计划和行动都必须符合这些约束条款。

## 约束条款

### 技术约束
- 必须使用 JavaScript (Node.js) 作为主要开发语言
- 必须保持 VSCode Extension API 版本 ^1.104.0 的兼容性
- 必须使用 Commander.js 处理 CLI 参数解析
- 必须使用 Express.js 作为 Web 服务器框架
- 必须使用 Marked 库进行 Markdown 渲染
- 必须使用 Chokidar 实现文件监控和热重载
- 必须使用 Socket.IO 实现浏览器端实时更新通信
- 必须使用 ignore 库处理 .specinclude 白名单文件

### 架构约束
- 必须保持双模式运行支持：CLI 模式和 VSCode Extension 模式
- 必须通过 .specinclude 白名单文件控制可访问的文件和目录
- 必须实现文件系统监控，支持文件变化时自动刷新
- 必须使用 Webview 构建 VSCode Extension 的用户界面
- 必须保持前端资源的自包含性，避免外部 CDN 依赖
- 必须支持相对路径和绝对路径的灵活处理

### 安全约束
- 必须使用白名单机制限制文件访问，防止目录遍历攻击
- 必须验证所有文件路径，确保在允许范围内
- 禁止暴露系统敏感目录和文件
- 必须验证用户输入的端口号和主机地址参数
- 必须使用 mime-types 库正确设置 Content-Type 响应头

### 功能约束
- 必须支持交互式目录树导航
- 必须支持多标签页文件浏览
- 必须支持 Markdown 文件渲染和代码高亮
- 必须支持深色/浅色主题切换
- 必须支持实时热重载功能
- 必须保持文件树的展开/折叠状态

### 用户体验约束
- 必须提供清晰的错误提示信息
- 必须在没有工作区时给出友好提示
- 必须使用防抖机制优化文件监控性能（300ms）
- 必须支持 Senatus 框架一键安装功能
- 必须提供刷新和全部折叠的便捷操作
- 必须在文件变化时自动更新视图

### 代码质量约束
- 必须使用清晰的模块划分：providers、utils、webview
- 必须添加必要的代码注释和函数文档
- 必须处理异步操作的错误情况
- 必须清理不再使用的资源（watcher、subscriptions）
- 必须使用一致的命名规范（驼峰命名）

### 配置管理约束
- 必须支持通过 .specinclude 文件配置白名单
- 必须提供命令行参数配置端口、主机和包含文件
- 必须在 package.json 中正确声明所有依赖
- 必须提供演示脚本便于快速体验
- 必须支持全局安装和本地安装两种方式

### 兼容性约束
- 必须兼容 Windows、macOS 和 Linux 平台
- 必须处理 Windows 平台的 SIGBREAK 信号
- 必须正确处理不同平台的路径分隔符
- 必须在 VSCode 环境中正确加载本地资源
- 必须支持现代浏览器的 WebSocket 连接

### 发布和分发约束
- 必须使用 MIT 许可证
- 必须提供完整的 README.md 文档
- 必须使用 @vscode/vsce 工具打包 VSCode 扩展
- 必须在 package.json 中配置正确的 bin 入口
- 必须提供安装、使用和配置说明

### Senatus 任务计划约束
- 禁止在任务计划中添加测试相关的任务项（测试应在开发过程中自然进行）
- 任务计划应聚焦于核心实现任务，避免过度细分
- 任务项描述应简洁明确，包含具体的实现目标和技术方案

## 约束更新

更新此文件时需要：
1. 递增版本号
2. 更新最后修订时间
3. 在下方版本历史中添加更新记录

---
**版本**: v1.2.0 | **最后修订**: 2025-10-14

<!--
版本历史格式：v[版本号] - [日期]: [更新说明]

v1.2.0 - 2025-10-14: 更新 Senatus 术语，将"行动计划"改为"任务计划"，任务编号从 T01 改为 T01
v1.1.0 - 2025-10-11: 新增 Senatus 任务计划约束，要求禁止添加测试任务项，聚焦核心实现，避免过度细分
v1.0.0 - 2025-09-30: 初始宪法文件，定义 Spec Viewer 项目的核心约束条款
-->