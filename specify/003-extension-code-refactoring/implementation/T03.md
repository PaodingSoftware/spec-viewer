# 实现记录 - T03

## 任务信息
- **编号**: T03
- **描述**: 在 file-utils.js 中添加 validatePath() 和 debounce() 静态方法

## 实现细节

### 新增的 FileUtils 类
在 `extension/src/utils/file-utils.js` 文件末尾添加：

```javascript
class FileUtils {
    static validatePath(basePath, targetPath, protectedFiles = []) {
        const resolvedBase = path.resolve(basePath);
        const resolvedTarget = path.resolve(basePath, targetPath);
        
        // 防止目录遍历攻击
        if (!resolvedTarget.startsWith(resolvedBase)) {
            throw new Error('Invalid path: Directory traversal detected');
        }
        
        // 检查保护文件
        const relativePath = path.relative(resolvedBase, resolvedTarget);
        for (const protectedFile of protectedFiles) {
            if (relativePath === protectedFile || relativePath.startsWith(protectedFile + path.sep)) {
                throw new Error(`Invalid path: Cannot access protected file ${protectedFile}`);
            }
        }
        
        return resolvedTarget;
    }

    static debounce(func, delay) {
        let timeoutId;
        const debounced = function(...args) {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => func.apply(this, args), delay);
        };
        debounced.cancel = function() {
            clearTimeout(timeoutId);
        };
        return debounced;
    }
}
```

### 方法说明

#### validatePath(basePath, targetPath, protectedFiles)
- **功能**: 验证路径安全性，防止目录遍历攻击和访问受保护文件
- **参数**:
  - `basePath`: 基础路径（如工作区根目录）
  - `targetPath`: 目标路径（相对或绝对）
  - `protectedFiles`: 受保护的文件列表（可选，如 `['specify/constitution.md']`）
- **返回**: 解析后的安全路径
- **异常**: 如路径不安全则抛出 Error

#### debounce(func, delay)
- **功能**: 创建防抖函数，延迟执行
- **参数**:
  - `func`: 要防抖的函数
  - `delay`: 延迟时间（毫秒）
- **返回**: 防抖函数（包含 `.cancel()` 方法）
- **特性**: 支持通过 `.cancel()` 取消待执行的调用

### 导出更新
```javascript
module.exports = { FileFilter, FileUtils };
```

---
*创建时间: 2025-10-11*
