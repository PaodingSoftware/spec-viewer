# 实现记录 - T18

## 任务信息
- **编号**: T18
- **描述**: 修复 file-viewer-provider.js 中 marked 库的导入错误（使用命名导入）

## 实现细节

### 问题分析
用户在打开 markdown 文件时遇到错误：
```
Failed to load file: marked is not a function
```

经过代码审查发现，`extension/src/providers/file-viewer-provider.js` 文件中使用了错误的 marked 库导入方式。

### 错误代码
```javascript
// file-viewer-provider.js 第 4 行
const marked = require('marked');
```

当代码执行到 `marked(content)` 时，由于 marked v9.x 使用命名导出而非默认导出，`marked` 变量实际上是一个对象而非函数，导致报错 "marked is not a function"。

### 根本原因
- marked 库从 v9.0.0 开始使用 ES6 命名导出
- 正确的导入方式是解构 `{ marked }`
- 项目其他文件已正确使用命名导入：
  - `src/server.js` 第 9 行：`const { marked } = require('marked');`
  - `extension/src/utils/senatus-parser.js` 第 3 行：`const { marked } = require('marked');`

### 修复方案
更新 `file-viewer-provider.js` 第 4 行，使用命名导入：

```javascript
// 修复后的代码
const { marked } = require('marked');
```

### 修改文件
- `extension/src/providers/file-viewer-provider.js`

### 变更详情
```diff
const vscode = require('vscode');
const path = require('path');
const fs = require('fs').promises;
-const marked = require('marked');
+const { marked } = require('marked');
const { WebviewBase } = require('../utils/webview-utils');
```

### 验证方法
1. 在 VSCode 中打开任意 markdown 文件
2. 使用 Spec Viewer 打开该文件
3. 确认 markdown 内容正确渲染，无错误提示

### 符合宪法约束
- ✅ 遵循"必须使用 Marked 库进行 Markdown 渲染"
- ✅ 使用正确的 API 调用方式
- ✅ 与项目其他文件保持一致性

---
*创建时间: 2025-10-11*
