# 实现记录 - T25

## 任务信息
- **编号**: T25
- **描述**: 更新所有 Provider 中的模板加载调用从 super/this 改为 this.webviewUtils

## 实现细节

### 修改的文件

1. `extension/src/providers/dashboard-provider.js`
2. `extension/src/providers/file-viewer-provider.js`
3. `extension/src/providers/sidebar-provider.js`

### 变更内容

#### 1. Dashboard Provider

**getDashboardHtml() 方法**：
```javascript
// 修改前
const template = await super.loadTemplate('extension/webview/dashboard/dashboard.html');

// 修改后
const template = await this.webviewUtils.loadTemplate('extension/webview/dashboard/dashboard.html');
```

**getErrorHtml() 方法**：
```javascript
// 修改前
const template = await this.loadTemplate('extension/webview/dashboard/error.html');

// 修改后
const template = await this.webviewUtils.loadTemplate('extension/webview/dashboard/error.html');
```

#### 2. File Viewer Provider

**getMarkdownWebviewContent() 方法**：
```javascript
// 修改前
const htmlTemplate = await super.loadTemplate('extension/webview/viewer/viewer.html');

// 修改后
const htmlTemplate = await this.webviewUtils.loadTemplate('extension/webview/viewer/viewer.html');
```

**getTextWebviewContent() 方法**：
```javascript
// 修改前
const template = await super.loadTemplate('extension/webview/viewer/text.html');

// 修改后
const template = await this.webviewUtils.loadTemplate('extension/webview/viewer/text.html');
```

**getErrorWebviewContent() 方法**：
```javascript
// 修改前
const template = await super.loadTemplate('extension/webview/viewer/error.html');

// 修改后
const template = await this.webviewUtils.loadTemplate('extension/webview/viewer/error.html');
```

#### 3. Sidebar Provider

**getHtmlContent() 方法**：
```javascript
// 修改前
const template = await this.loadTemplate('extension/webview/sidebar/sidebar.html');

// 修改后
const template = await this.webviewUtils.loadTemplate('extension/webview/sidebar/sidebar.html');
```

### 调用方式对比

| 调用方式                           | 说明               | 适用场景   |
| ---------------------------------- | ------------------ | ---------- |
| `super.loadTemplate()`             | 调用父类方法       | 继承模式   |
| `this.loadTemplate()`              | 调用继承的方法     | 继承模式   |
| `this.webviewUtils.loadTemplate()` | 调用组合对象的方法 | 组合模式 ✓ |

### 优势

- **明确依赖关系**：通过 `this.webviewUtils` 明确表明使用了 WebviewUtils 的功能
- **解耦**：Provider 不再依赖 WebviewUtils 的内部实现
- **可测试性**：可以轻松 mock `this.webviewUtils` 进行单元测试
- **灵活性**：可以在运行时替换或扩展 webviewUtils 实例

---
*创建时间: 2025-10-11*
