````markdown
# 实现记录 - T04

## 任务信息
- **编号**: T04
- **描述**: 在 `senatus-installer.js` 中实现 Cursor 命令文件复制逻辑：从 `.github/prompts/` 读取 prompt 文件，去掉 `.prompt` 后缀后复制到目标项目的 `.cursor/commands/` 目录

## 实现细节

### 修改内容
在 `extension/src/utils/senatus-installer.js` 中实现 Cursor 自定义命令的动态生成和复制功能。

### 代码变更

#### 1. 更新安装确认提示信息
```javascript
// 原代码
const choice = await vscode.window.showInformationMessage(
    'Install Senatus Framework? This will copy Claude commands and Specify templates to your project.',
    { modal: true },
    'Install'
);

// 修改后
const choice = await vscode.window.showInformationMessage(
    'Install Senatus Framework? This will copy Claude commands, GitHub Copilot prompts, Cursor commands, and Specify templates to your project.',
    { modal: true },
    'Install'
);
```

#### 2. 创建 Cursor 命令目录
```javascript
// 添加 Cursor 命令目录创建
const cursorCommandsDir = path.join(workspaceFolder, '.cursor', 'commands');
await fs.mkdir(cursorCommandsDir, { recursive: true });
```

#### 3. 调用 Cursor 命令复制方法
```javascript
// 在复制 GitHub Copilot prompts 之后添加
// Copy and rename prompt files for Cursor commands
await this.copyCursorCommands(sourcePromptsDir, cursorCommandsDir);
```

#### 4. 新增 copyCursorCommands 方法
```javascript
/**
 * Copy and rename prompt files for Cursor commands
 * @param {string} sourcePromptsDir - Source prompts directory (.github/prompts)
 * @param {string} targetCommandsDir - Target Cursor commands directory (.cursor/commands)
 */
async copyCursorCommands(sourcePromptsDir, targetCommandsDir) {
    try {
        const entries = await fs.readdir(sourcePromptsDir, { withFileTypes: true });

        for (const entry of entries) {
            if (entry.isFile() && entry.name.endsWith('.prompt.md')) {
                const sourcePath = path.join(sourcePromptsDir, entry.name);
                // Remove '.prompt' from filename (e.g., 'senatus.discuss.prompt.md' -> 'senatus.discuss.md')
                const newName = entry.name.replace('.prompt.md', '.md');
                const targetPath = path.join(targetCommandsDir, newName);
                await fs.copyFile(sourcePath, targetPath);
            }
        }
    } catch (error) {
        console.warn('Failed to copy Cursor commands:', error.message);
    }
}
```

### 实现逻辑
1. **动态生成**：从 `.github/prompts/` 目录读取所有 `.prompt.md` 文件
2. **文件重命名**：自动去掉 `.prompt` 后缀（如 `senatus.discuss.prompt.md` → `senatus.discuss.md`）
3. **复制到目标**：将重命名后的文件复制到 `.cursor/commands/` 目录
4. **错误处理**：使用 try-catch 包裹，复制失败时仅警告不中断安装流程

### 技术特点
- **单一数据源**：只维护 `.github/prompts/` 中的 prompt 文件
- **自动化处理**：安装时自动生成 Cursor 命令文件
- **容错设计**：即使 Cursor 命令复制失败也不影响整体安装
- **代码风格一致**：遵循项目现有的异步处理和错误处理模式

---
*创建时间: 2025-10-16*

````